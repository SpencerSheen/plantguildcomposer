<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Plant Guild Composer</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=2.0">
	
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/bootstrap-responsive.min.css">
<!--	<link rel="stylesheet" href="css/style.css?old">-->
	<link rel="stylesheet" href="css/map_style.css">
	
	

	<script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
    	/* Code is derived and then heavily modified from:  https://developers.google.com/chart/interactive/docs/gallery/linechart?hl=en  */
      google.load("visualization", "1", {packages:["corechart"]});
    
      function drawLineChart(data_array, options, div) {
       
        var data = google.visualization.arrayToDataTable(data_array);

        var chart = new google.visualization.LineChart(document.getElementById(div) );
        chart.draw(data, options);
      }
      
    </script>
    
    <!-- use to chose hte file with file chooser
    <input type="file" id="fileinput" />-->
<script type="text/javascript">
  
  function importData(contents){
	//first row are the data labels
	rows = contents.split("\n");
	label_array = rows[0].split(",");
	
	var value_array = [];
	value_array.length = rows.length-1;
	
	//we start at one because the first entry in rows were stored in label_array
	for(i=1; i<rows.length; i++){
		value_array[i-1]= rows[i].split(",");
	}
	
	//temperature chart
	chart_data = [];
	chart_data[0] = new Array("Date", label_array[1], label_array[2], label_array[3]);
	
	for(i=0; i< value_array.length; i++){
			chart_data[i+1] = new Array(value_array[i][0], parseInt(value_array[i][1]), parseInt(value_array[i][2]), parseInt(value_array[i][3]));
	}
	
	var options = {
		width: 350,
		heigth: 300,
		chartArea: {width: "80%", left:"60"},
		title: "One Year Temperature History",
		vAxis: {title: "Fahrenheit"},
		lineWidth: ".05",
		pointSize: "1",
		legend: {position: 'top'},
		colors: ['#d9005b', '#00b945', '#e2fa00', '#bd003b']
	}
		
	drawLineChart(chart_data, options, "chart_div");
	
	
	//precipitation chart
	chart_data = [];
	chart_data[0] = new Array("Date", label_array[19]);
	
	for(i=0; i< value_array.length; i++){
			chart_data[i+1] = new Array(value_array[i][0], parseFloat(value_array[i][19]));
	}
	
	var options = {
		title: "One Year Precipitation History",
		chartArea: {width: "80%", left:"60"},
		vAxis: {title: "Inches"},
		lineWidth: ".05",
		pointSize: "1",
		legend: {position: 'top'},
		width: 350,
		colors: ['#d9005b', '#00b945', '#e2fa00', '#bd003b']
	}
	
	drawLineChart(chart_data, options, "chart_div_rain");
	
	//wind speed and gust chart
	chart_data = [];
	chart_data[0] = new Array("Date", label_array[17], label_array[18]);
	
	for(i=0; i< value_array.length; i++){
			chart_data[i+1] = new Array(value_array[i][0], parseInt(value_array[i][17]), parseInt(value_array[i][18]));
	}
	var options = {
		title: "One Year Wind Speed History",
		chartArea: {width: "80%", left:"60"},
		vAxis: {title: "MPH"},
		lineWidth: ".05",
		pointSize: "1",
		legend: {position: 'top'},
		width: 350,
		colors: ['#d9005b', '#00b945', '#e2fa00', '#bd003b']
	}
	drawLineChart(chart_data, options, "chart_div_windspeed");
	
	//wind direction
	chart_data = [];
	chart_data[0] = new Array("Date", label_array[22]);
	
	for(i=0; i< value_array.length; i++){
			chart_data[i+1] = new Array( value_array[i][0], parseInt(value_array[i][22]));
	}
	
	var options = {
		title: "One Year Wind Direction History",
		chartArea: {width: "80%", left:"60"},
		vAxis: {title: 'Direction (N: 360, S: 180)', minValue: 0, maxValue: 360},
		lineWidth: "0",
		pointSize: "2",
		legend: {position: 'top'},
		width: 350,
		colors: ['#d9005b', '#00b945', '#e2fa00', '#bd003b']
	}
	
	drawLineChart(chart_data, options, "chart_div_winddirection");
}

  function readTextFile(file)
{
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, true);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
                var allText = rawFile.responseText;
                importData(allText);
            }
        }
    }
    rawFile.send(null);
}
  
  function readSingleFile(evt) {
    //Retrieve the first (and only!) File from the FileList object
    
    var f = evt.target.files[0]; 

    if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
	      var contents = e.target.result;
        /*alert( "Got the file.\n" 
              +"name: " + f.name + "\n"
              +"type: " + f.type + "\n"
              +"size: " + f.size + " bytes\n"
              + "starts with: " + contents.substr(1, contents.indexOf("\n"))
        );  */
        
        importData(contents);
        
      }
      r.readAsText(f);
    } else { 
      alert("Failed to load file");
    }
    
    document.getElementById('fileinput').style.visibility = 'hidden';
  }
  
  function toggle_weather_f (){
	//from forecast to historical
  	document.getElementById('forecast-dash').parentNode.parentNode.style.display = 'none';
  	document.getElementById('weatherhistory-dash').parentNode.parentNode.style.display = 'inline';
  
    }
function toggle_weather_h (){
    //from historical to forecast
   
      	document.getElementById('weatherhistory-dash').parentNode.parentNode.style.display = 'none';
  	document.getElementById('forecast-dash').parentNode.parentNode.style.display = 'inline';
  	}
  

  /*Need if going to use the file chooser to import the climate data
  document.getElementById('fileinput').addEventListener('change', readSingleFile, false);
*/

</script>
    
</head>
<body data-spy="scroll" data-target="#navbar" data-offset="20">
	<div id="topbar"><p id="headertext">Plant Guild Composer</p></div>
	<div class="fullscreen-container" style="margin-left:35px">
		<div id="map-row" class="row" >
			<div id="map">
				<div class="span2">
					<div class="container-item map-item">
					 
						<div id="q1" class="alert alert-success" style="display:none;">Draw the perimeter of your plant guild
						<i class="icon-arrow-right"></i>
						</div>
						
						<div id="composer-icons"  style="display:none;">
							<div class="btn-group btn-group-vertical" data-toggle="buttons-radio">
							    <h4>Key Species</h4>
							    <button class="btn" data-category="key" data-size="50" data-name="Avocado Tree"><img src="img/tree.png"/><p name="avocado">Avocado Tree</p></button>
							    <button class="btn" data-category="key" data-size="50" data-name="Orange Tree"><img src="img/tree.png"/><p name="orange">Orange Tree</p></button>
							    <button class="btn" data-category="key" data-size="50" data-name="Persimmon Tree"><img src="img/tree.png"/><p name="persimmon">Persimmon Tree</p></button>
								<h4>Support Species</h4>
								<button class="btn" data-category="pests" data-size="20" data-name="Lemon Grass"><img src="img/herb.png"/><p name="lemon grass">Lemon Grass</p></button>
								<button class="btn" data-category="nitrogen" data-size="30" data-name="Pigeon Peas"><img src="img/shrub.png"/><p name="pigeon pea">Pigeon Peas</p></button>
								<button class="btn" data-category="nitrogen" data-size="30" data-name="Mexican Sunflower"><img src="img/herb.png"/><p name="mexican sunflower">Mexican Sunflower</p></button>
								<button class="btn" data-category="none" data-size="40" data-name="Elderberry"><img src="img/understory.png"/><p name="elder">Elderberry</p></button>

								<button class="btn" data-category="pests" data-size="10" data-name="Clover"><img src="img/herb.png"/><p name="clover">Clover</p></button>
								<button class="btn" data-category="nitrogen" data-size="10" data-name="Comfrey"><img src="img/shrub.png"/><p name="comfrey">Comfrey</p></button>
								<button class="btn" data-category="pests" data-size="10" data-name="Chives"><img src="img/understory.png"/><p name="chives">Chives</p></button>
								<button class="btn" data-category="pests" data-size="25" data-name="Lavendar"><img src="img/herb.png"/><p name="lavender">Lavender</p></button>
							</div>
						</div>
					</div>
				</div>
				<div class="span8" style="height:100%;">
					<div class="container-item">
						<div id="map-canvas" style="height:100%;"></div>
					</div>
				</div>
				<div class="span4" style="display:none;">
					<div class="container-item">
						<div id="forecast-dash" class="map-item">
							<input type="button" id="weather_toggle_forecast" value="Switch to Historical" onclick="toggle_weather_f()"/>
							<h4>Temperature <i class="icon-fire"></i></h4>
							<h2 id="temperature"><span id="value"></span><span class="muted">°F</span></h2>
							<h4>Humidity <i class="icon-tint"></i></h4>
							<h2 id="humidity"><span id="value"></span><span class="muted">%</span></h2>
							<h4>Wind <i class="icon-plane"></i></h4>
							<svg id="wind-bearing" xmlns="http://www.w3.org/2000/svg" version="1.1" width="50" height="50" viewBox="0 0 50 50">>
							  <path d="M25,0 L40,50 L25,35 L10,50 L25,0" />
							</svg>
							<p id="wind-bearing-value">
								<span id="value"></span><span class="muted">°</span>
							</p>
							<h2 id="wind-speed"><span id="value"></span><span class="muted">mph</span></h2>
							<h6>
					        	Powered by <a href="http://forecast.io">Forecast.io</a>
					      	</h6>
							</div>
						</div>
				</div>
				<div class="span4" >
					<div class="container-item">
						<div id="weatherhistory-dash" class="map-item">
							<input type="button" id="weather_toggle_history" value="Switch to Live" onclick="toggle_weather_h()"/>
							<h4>Temperature <i class="icon-fire"></i></h4>
							<!--<h2 id="temperature"><span id="value"></span><span class="muted">°F</span></h2>-->
							<div id="chart_div" style="width: 350px; height: 300px;"></div>
							<h4>Precipitation<i class="icon-tint"></i></h4>
							<!--<h2 id="humidity"><span id="value"></span><span class="muted">%</span></h2>-->
							<div id="chart_div_rain" style="width: 350px; height: 300px;"></div>
							<h4>Wind <i class="icon-plane"></i></h4>
							<!--<svg id="wind-bearing" xmlns="http://www.w3.org/2000/svg" version="1.1" width="50" height="50" viewBox="0 0 50 50">>
							  <path d="M25,0 L40,50 L25,35 L10,50 L25,0" />
							</svg>
							<p id="wind-bearing-value">
								<span id="value"></span><span class="muted">°</span>
							</p>-->
							<div id="chart_div_windspeed" style="width: 350px; height: 300px;"></div>
							<!--<h2 id="wind-speed"><span id="value"></span><span class="muted">mph</span></h2>-->
							
							<div id="chart_div_winddirection" style="width: 350px; height: 300px;"></div>
							
							</div>
						</div>
				</div>
		</div>
	</div>
		
		
		<div id="dashboard" class="row" style="display:none;">
<!--			<div class="span12 container-item">-->
			
				<div class="span8">
					<div class="container-item" id="inspector">
					<div class="dashboard-item">
					<h3>Inspector</h3>
					<label class="pull-left text-center">
						<!-- inspector media goes into this label with javascript -->
					</label>
					<div id="more-info" class="media-body">
					</div>
					</div>
					</div>
				</div>
				<div class="span4">
				<div class="container-item">
					<div class="dashboard-item">
					<h3>Guild Viability</h3>
					<label class="control-label">Nutrient Availability</label>
					<div class="progress">
					  <div class="nitrogen-bar bar bar-info" style="width:0%"></div>
					</div>
					<label class="control-label">Pest Control Availability</label>
					<div class="progress">
					  <div class="pests-bar bar bar-success" style="width:0%"></div>
					</div>	
					</div>	
				</div>
				</div>
				<div class="span2">
				<div class="container-item">
					<div class="dashboard-item"> 
						<h3>Guild Members</h3>
						<h4>Key Species</h4>
						<div id="guild-list-key">
						 Avocado
						 </div>
						<h4>Support Species</h4>
						<div id="guild-list-support">
							Elderberry Tree x 1
							Pigeon Pea x 2
							Comfrey x 5
							Mexican Sunflower x 2
						</div>
					</div>
					</div>
				</div>				
		<!--	</div>-->
		</div>
		
		<!--<div id="options-row" class="row">
			<div id="options" style="display:none;">
				<div class="span4">
					<div id="card1" class="container-item">
						<form>
						<p>Is there a building to the south of the guild?</p>
						<div class="btn-group" data-toggle="buttons-radio">
						  <input type="button" class="btn btn-good" value="Yes" />
						  <input type="button" class="btn btn-bad" value="No" />
						</div>
						</form>
					</div>
				</div>
				<div class="span4">
					<div id="card2" class="container-item">
					<div class="container-item">
						<ul id="sortable-species">
							<li class="item">Avocado</li>
							<li class="item">Navel Orange</li>
							<li class="item">Persimmon</li>
						</ul>
					</div>
					</div>
				</div>
				<div class="span4">
					<div id="card2" class="container-item">
						<div class="container-item">
							<ul id="sortable">
								<li class="item">Mexican Sunflower - Dynamic Accumulator</li>
								<li class="item">Lavender - Pollenating</li>
								<li class="item">Strawberry</li>
								<li class="item">Rosemary - Pest</li>
								<li class="item">Pigeon Pea - NF</li>
								<li class="item">Marigold - Pest</li>
								<li class="item">Chard</li>
								<li class="item">Onion - Pest</li>
								<li class="item">Garlic - Pest</li>
								<li class="item">Leek - Pest</li>
								<li class="item">Radish - Pest</li>
								<li class="item">Yarrow - Dynamic Accumulator</li>
								
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id="more-row"class="row">
			<div id="more"  style="display:none;">
				<div id="card3" class="span4">
					
				</div>
				<div class="span4">
					<div class="container-item">
					Lorem IpsumLorem IpsumLorem IpsumLorem IpsumLorem Ipsum
					</div>
				
				</div>
				<div class="span4">
					<div class="container-item">
					Lorem IpsumLorem IpsumLorem IpsumLorem IpsumLorem Ipsum
					</div>
				</div>
			</div>
		</div>
			
			-->
		</div>
</div>
<!--	</div> -- /container -->

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
	<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
	<script src="js/vendor/bootstrap.min.js"></script>
	<script src="js/plugins.js"></script>
	<script src="js/lib/underscore-min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.9.3/TweenMax.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=weather,drawing"></script>
	<script src="js/forecast.io.js"></script>
	<!--<script src="js/main.js"></script>-->
	
	
	
	
	
	
	
	
	
	
	
	
	<script>
	$(document).ready(function(){
	
		//set everything initially to hide. This was slow, so instead I just added style="display:none;" for all the things that needed to be hidden.
		$( "#sortable" ).sortable();
		$( "#sortable" ).disableSelection();
		$( "#map" ).hide();
		$( "#options" ).hide();
		$( "#more" ).hide();
	   	$( "#q1" ).hide();
		$( "#q2" ).hide();
		$( "#menu-map").hide();
		$( "#menu-options").hide();
		$( "#menu-more").hide(); 
		$( "#composer-icons").hide();
		$( "#dashboard" ).hide();
		$( "#map-row div.img").draggable({ opacity: 0.7, helper: "original" });
	   
	   //displays the pop up over the current location button, and 
		$("#current-location").popover({trigger: 'hover', delay: { show: 900, hide: 10 }});
		//click event for current location
	    $("#current-location").click(function (){
	    	  //sets the state of the button to loading.
			  $("#current-location").button("loading");
			  //slide down the map menu for the navigation menu
			  $("#menu-map").slideDown();
			  //after the load event on the window triggers, call the getCurrentLocation function
			  google.maps.event.addDomListener(window, 'load', getCurrentLocation(function(pos){
				  console.log("resetting button");
				  //reset the loading state on the current location button
				  $("#current-location").button("reset");
				  //set the color of the input to blue
				  $("input[name='start-location']").addClass("input-primary");
				  //set the color of the group to blue
				  $("#current-location-group").addClass("info");
				  //change the color of the button to blue
				  $("#current-location").addClass("btn-primary");
				  //change the color of the icon for current location to white
				  $("#current-location i").addClass("icon-white");
				  
				  //console.log("before scroll");
				  console.log(pos);
				  
				  //get the address for the gps location and set that in the location input
				  //the second argument is a callback function that is triggered after the getAddress method is called
				  getAddress(pos, function(data){
				  	console.log(data);
				  	$("#location").val(data);
				  });
				  //refresh the spy scroller, check bootstrap documentation for spy-scroll
				  refreshSpy();
			  }));
			  
			  
		});
	  
		//trigger the onFind event, the search for location button
	  	$('#find').on('click', function(event) {
	  		//prevent the page from reloading
			event.preventDefault();
			//slide the map menu item from the navigation bar down
			$("#menu-map").slideDown();
			//make an address variable with the text from the location input
			var address = $('#find').val();
				//get the gps location for the address from google's geolocation service
				getGPS(address, function(data){
					//log the return data
					console.log(data);
					//slide the map down
					slideMapDown(data);
				});
			//change the drawing tools to include the polygon tool	
			addPolygonDrawing();
			//refresh the spy-scroll, check bootstrap docs
			refreshSpy();
			});
	    
	    //trigger event for selecting plants from the side bar
	  	$('#composer-icons button').click(function(){
	  	
		  //make variables from the composer icons html 
		  //get the source from button's img 
		  var icon_img = $(this).find("img").attr('src');
		  //get the category from data-category
		  var icon_category = $(this).attr("data-category");
		  //get the name from data-name
		  var icon_name = $(this).find("p").attr('name');
		  //get size of icon from data-size
		  var icon_size = $(this).attr("data-size");
		  //set the Drawing Manager to the current plant selected
		  setDrawing(icon_img, icon_category, icon_name, icon_size);
		  //hide the inspector if there is something already showing
		  $('#inspector').hide();
		  //set the inspector to the current button's html
		  $('#inspector label').html($(this).html());
		  $('#inspector label').find('img').addClass("img-polaroid");
		  switch ($(this).find("p").attr('name')){
		  
			  case 'avocado': 
			  		content =  '<h4 class="media-heading">Avocado Tree</h4><p>Family: Lauraceae <br>Binomial Name: <span class="italics">Persea americana</span></p> <h4>Characteristics</h4><p>Layer: Canopy or Understory<br>Height: 30-40 ft, (dwarf) 12-15 ft <br>Spread: 15-35 ft, (dwarf) 8-12 ft<br> Roots: Shallow<br>Canopy: Dense<br>Shedding:Evergreen<br>Harvest Season: Spring<br>Hardiness Zone: 9</p><h4>Needs</h4><p>Nutrients: Nitrogen, Potassium, and Phosphorus<br>Water: Moderate, soil should be moist roughly 9\" deep (use mulch).<br>Sun: Full Sun<br>Pest and pathogens: (Pests) Mites, Thrips; (Pathogens) Laurel wilt.</p><h4>Products and Behaviors</h4><p>Edibles: 80-140 lbs Avocado Fruit<br>Raw Material: Leaf-Biomass, poisonous seeds<br>Attracted Insects: Glassy-winged sharpshooter (Homalodisca vitripennis) Pierce\'s Disease vector</p>';
					$('#more-info').html(content);
					break;
			  case 'persimmon':
			  		content = '<h4 class="media-heading">Persimmon Tree</h4><p>Family: Ebenaceae <br>Binomial Name: <span class="italics">Diospyros virginiana</span></p> <h4>Characteristics</h4><p>Layer: Canopy or Understory<br>Height: 30-80 ft<br>Spread: 25-50 ft<br> Roots: Deep Tap-Root<br>Canopy: Dense<br>Shedding: Deciduous<br>Harvest Season: Autumn<br>Hardiness Zone: 5 thru 9<br> Heat Zone: 9 thru 4</p><h4>Needs</h4><p>Nutrients: Nitrogen, and Phosphorus<br>Water: Moderate.<br>Sun: Full Sun<br>Pest and pathogens: (Pests) Aphids</p><h4>Products and Behaviors</h4><p>Edibles: Persimmon Fruit<br>Raw Material: Leaf-Biomass, timber, fuel wood<br> Biochemical Material: Potassium, Magnesium, Calcium, Iron, Phenolic Compounds<br>Cultural and Amenity: Aesthetic<br>Medicinal and Nutrition: Dietary Fiber, Anti-oxidant, Vitamin C and Beta Carotene</p>';
			  		$('#more-info').html(content);
			  		break;
			  case 'orange':
			  		content = '<h4 class="media-heading">Orange Tree</h4> <p> Family: Rutaceae	<br>Binomial Name:  <span class="italics">Citrus sinensis</span> <\p> <h4>Characteristics</h4><p>Layer: Understory<br>Height: 18-25 ft<br>Spread: 12-16 ft<br> Roots: Shallow<br>Canopy: Dense<br>Shedding: Evergreen<br>Harvest Season: Autumn, Variety Dependent<br>Hardiness Zone: 9 thru 11<br> Heat Zone: 8 thru 11</p><h4>Needs</h4><p>Nutrients: Nitrogen, Phosphorus, Magnesium, Boron, Copper, Zinc<br>Water: Moist<br>Sun: Full Sun<br>Inoculents: Mycorrhizal Fungi<br>Pest and pathogens: (Pests) Aphids</p><h4>Products and Behaviors</h4><p>Edibles: Persimmon Fruit<br>Raw Material: Leaf-Biomass, timber, fuel wood<br> Biochemical Material: Potassium, Magnesium, Calcium, Iron, Phenolic Compounds<br>Cultural and Amenity: Aesthetic<br>Medicinal and Nutrition: Dietary Fiber, Anti-oxidant, Vitamin C and Beta Carotene</p>';
			  		$('#more-info').html(content);
			  		break;
			  case 'pigeon pea':
				  content = '<h4 class="media-heading">Pigeon Pea</h4> <p>Family: Fabaceae <br>Binomial Name:  <span class="italics">Cajanus cajan</span> <\p> <h4>Characteristics</h4><p>Layer: Understory<br>Height: 3-12 ft<br>Spread: 1-4 ft<br>Canopy: Moderate<br> Shedding: Evergreen<br>Harvest Season: 5-8 Months After Planting<br>Hardiness Zone: 9 thru 15</p><h4>Needs</h4><p>Water: Well Drained<br>Sun: Full Sun<br>Inoculents: Nitrogen Fixing Rhizobia</p><h4>Products and Behaviors</h4><p>Edibles: Peas<br>Raw Material: Mulch<br> Biochemical Material: Nitrogen<br>nMedicinal and Nutrition: Dietary Fiber, Protein, Copper</p>';
				  $('#more-info').html(content);
				  break;			  
			  case 'mexican sunflower':
				  content = '<h4 class="media-heading">Mexican Sunflower</h4> <p>Family: Asteraceae <br>Binomial Name:  <span class="italics">Tithonia diversifolia</span> <\p> <h4>Characteristics</h4><p>Layer: Shrub<br>Height: 6-15 ft<br>Spread: 8-12 ft<br>Canopy: Dense<br> Shedding: Evergreen<br>Harvest Season: year round<br>Hardiness Zone: 9 thru 11</p><h4>Needs</h4><p>Nutrients: Nitrogen <br> Water: Well Drained<br>Sun: Full Sun</p><h4>Products and Behaviors</h4><p>Raw Material: Mulch<br> Biochemical Material: Potassium<br>Cultural and Amenity: Fragrant flower <br>Animals: humming birds<br>Attracted Insects: Butterflies, Bees</p>';
				  $('#more-info').html(content);
				  break;
			  case 'comfrey':
				  content = '<h4 class="media-heading">Comfrey</h4> <p>Family: Boraginaceae <br>Binomial Name:  <span class="italics">Symphytum uplandicum</span> <\p> <h4>Characteristics</h4><p>Layer: Ground Cover<br>Height: 2-3 ft<br>Spread: 12-15 in<br>Harvest Season: Year round after first year<br>Hardiness Zone: 4 thru 9</p><h4>Needs</h4><p>Nutrients: Nitrogen <br> Water: Moderate<br>Sun: Partial Shade</p><h4>Products and Behaviors</h4><p>Raw Material: Mulch<br> Biochemical Material: Potassium, Phosphorous<br>Medicinal: Cell proliferation when used as salve or poultice<br>Erosion Control: deep roots</p>';
				  $('#more-info').html(content);
				  break;
			  case 'lavender':
				  content = '<h4 class="media-heading">Lavender</h4> <p>Family: Lamiaceae <br>Binomial Name:  <span class="italics">Lavandula agustifolia</span> <\p> <h4>Characteristics</h4><p>Layer: Shrub<br>Height: 3-6 ft<br>Spread: 3-7 ft<br>Harvest Season: Year round<br>Hardiness Zone: 5 thru 10br>Heat Zone: 5 thru 10</p><h4>Needs</h4><p>Nutrients: Calcium <br> Water: Moderate<br>Sun: Full Sun, Partial Sun</p><h4>Products and Behaviors</h4><p>Edible: Herb for flavor<br>Raw Material: Leaves (mothball Substitute)<br>Cultural and Amenity: Aesthetic, artistic inspiration<br> Medicinal: Aromatherapy for relaxation and sleep<br>Attracted Insects: Bees</p>';
				  $('#more-info').html(content);
				  break;
			  case 'elder':
				  content = '<h4 class="media-heading">Elder Tree</h4> <p>Family: Caprifoliaceae <br>Binomial Name:  <span class="italics">Sambucus nigra</span> <\p> <h4>Characteristics</h4><p>Layer: Understory<br>Height: 6-14 ft<br>Spread: 4-16 ft<br>Harvest Season: Summer</p><h4>Needs</h4><p>Nutrients:  <br> Water: Moderate, Well Drained <br>Sun: Full Sun, Partial Sun</p><h4>Products and Behaviors</h4><p>Edible: Berries, flowers<br>Raw Material: Hard wood, hollow stems (combs, spindles, pegs)<br> Biochemical Material: <br>Cultural and Amenity: Musical instrument material (clappers, flutes), Considered a holy tree capable of restoring and keeping good health.<br> Medicinal: [Flowers] contain flavenoids and rutin, which are known to improve immune function in combination with vitamin C; contain tannins to reduce bleeding, diarrhea, and congestion; as tea used to break fevers, aid headache, indegestion, twitching eyes, dropsy, rheumatism, appendix inflammation, bladder or kidney infections, colds, influenza, bleeding in lungs, and mild enough for newborns. [Leaves, strong] can be steeped an used as a slight leaxitive, external poultice ingredient for soreness, inflammation, joint stiffness, and bee stings. [Berries] diuretic, used for arthritis and rheumatism, juice to use in salve for burns ans scalds, concentrated juice can be used as a purgative.<br>Erosion Control: On hill sides near water sources <br>Attracted Insects: valley elderberry longhorn beetle (endangered),  <br>Attracted Animals: song birds, game birds, squirrels, bears, deer, elk, moose</p>';
				  $('#more-info').html(content);
				  break;
			  default:
			  		$('#more-info').html(" ");
			  		break;	  			
		  }			  	
		  $('#inspector').slideDown('normal', function(){
		  	$('#more-info').slideDown();
		  });
	  	}); 
	});
	
	
 	var gmap; //global map variable
 	var glat = 33.6431859; //global lat and png values. Set initially to irvine
 	var glng = -117.8413502; //global lat and png values. Set initially to irvine
 	var geocoder; //global geocoder from google's geocoder API
 	var markersArray = new Array(); //array to store markers on map
 	var pixelSizeAtZoom0 = .000001; //the size of a pixel at map-zoom = 0
 	var maxPixelSize = 350; //restricts the maximum size of the icon, otherwise the browser will choke at higher zoom levels trying to scale an image to millions of pixels
 	var conditions; //weather conditions from the forecast.io api
 	var forecast = new ForecastIO(); //Forecast.io API

 	console.log(forecast);
 	google.maps.visualRefresh = true; //show the new Google Maps API as of May 2013
 	
	function initialize() 
	{
		
		
		
		geocoder = new google.maps.Geocoder();
		var pos = new google.maps.LatLng(60, 50);
		mapDiv = document.getElementById('map-canvas');
		
		var mapOptions = {
		    zoom: 20,
		    center: pos,
		    panControl: true,
		    zoomControl: true,
		    scaleControl: true,
		    mapTypeControl: true,
		    streetViewControl: false,
		    overviewMapControl: false,
		    mapTypeId: google.maps.MapTypeId.ROADMAP
		  }
		
		gmap = new google.maps.Map(mapDiv, mapOptions);
		//gmap.setTilt(0);
		drawingManager = new google.maps.drawing.DrawingManager();
		drawingManager.setMap(gmap);			
		
		addPolygonDrawing();
		 /*
		google.maps.event.addListener(drawingManager, 'polygoncomplete', function(polygon) {
				  
		});*/
		
		google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
		  if (event.type == google.maps.drawing.OverlayType.MARKER) {
		    //event.overlay.setTitle("Hello");
		    if(event.overlay.icon == "img/null.png"){
		    	$("#q1").html('Please select a key species <i class="icon-arrow-down"></i>');
		    	$("#q1").slideDown();
		    }
		    else{
			    console.log(event);
			    var icon_midpoint = event.overlay.getIcon().size.height/2;
			    console.log(icon_midpoint);
			    $("#q1").slideUp();
			    var size = $("#composer-icons button.active").attr("data-size");
			    var name = $("#composer-icons button.active").attr("data-name");
			    console.log("size:" + size);
			    addMarker(event.overlay, size, size, name);
			    var infowindow = new google.maps.InfoWindow({
			      content: '<div id="content" onmouseover="updateContent()"><h4>'+ name+'</h4><label class="control-label">Plant Viability</label><div class="progress"><div class="nitrogen-bar-total bar bar-info" style="width:0%"></div><div class="pests-bar-total bar bar-success" style="width:0%"></div></div>',
			      pixelOffset: new google.maps.Size(0, icon_midpoint)
			    });
			    google.maps.event.addListener(event.overlay,'click',function(){
			    	infowindow.open(gmap,event.overlay);
			    	updateProgressBars();
			    });
			    addGuildList("data-name");
			}
		  }
		  else if (event.type == google.maps.drawing.OverlayType.POLYGON) {
			  	console.log(event);
			  	event.overlay.setOptions({fillColor: '#FFFFFF'});
			   	$('#q1').slideUp(function(){
			   		$('#composer-icons').slideDown(function(){
			   			$('#dashboard').slideDown();
			   		});
			   		removePolygonDrawing();
			   });
		  }
		});
		
		google.maps.event.addListener(gmap, 'zoom_changed', function() {
			console.log("zoom:" + gmap.getZoom());
		    
		    var zoom = gmap.getZoom();
		    var relativePixelSize = pixelSizeAtZoom0*Math.pow(2,zoom); // use 2 to the power of current zoom to calculate relative pixel size.  Base of exponent is 2 because relative size should double every time you zoom in
		
		    /*if(relativePixelSize > maxPixelSize) //restrict the maximum size of the icon
		        relativePixelSize = maxPixelSize;*/
		
		    //change the size of the icon
		    _.each(markersArray, function(value, key, list){
		    	console.log(value.width + "*" + relativePixelSize);
		    	console.log(value.marker.getIcon());
		    	value.marker.setIcon(
		    	    new google.maps.MarkerImage(
		    	        value.marker.getIcon().url, //marker's same icon graphic
		    	        null,//size
		    	        null,//origin
		    	        null, //anchor
		    	        new google.maps.Size(value.width*relativePixelSize, value.height*relativePixelSize) //changes the scale
		    	    )
		    	);   
		    
		    });
		    
		         
		});
			
		var weatherLayer = new google.maps.weather.WeatherLayer({
		 		temperatureUnits: google.maps.weather.TemperatureUnit.FAHRENHEIT
				});
		weatherLayer.setMap(gmap);
			
		var cloudLayer = new google.maps.weather.CloudLayer();
		cloudLayer.setMap(gmap);
		
		
		//slide the map menu item from the navigation bar down
			$("#menu-map").slideDown();
			//make an address variable with the text from the location input
			var address = '28 Murasaki, Irvine, CA 92617';
				//get the gps location for the address from google's geolocation service
				getGPS(address, function(data){
					//log the return data
					console.log(data);
					//slide the map down
					slideMapDown(data);
				});
			//change the drawing tools to include the polygon tool	
			addPolygonDrawing();
			//refresh the spy-scroll, check bootstrap docs
			refreshSpy();
			
	} 

	google.maps.event.addDomListener(window, 'load', initialize);
	
	
	
	function slideMapDown(pos)
	{
		var mapRow = $("#map");
		mapRow.show("normal", function()
		{
			console.log(pos);
			scroll("#map");
			TweenMax.to(mapRow, 1, {
				 height:"400px", ease:Quad.easeOut, onComplete: function()
				 {
					 google.maps.event.trigger(gmap, 'resize');
					 gmap.setZoom( gmap.getZoom() );
					 gmap.setCenter(pos);
					 //gmap.setTilt(0);
					 var marker = new google.maps.Marker({
						 map: gmap,
						 position: pos
					 });
					 $("#q1").slideDown();
					 loadForecast(pos.lat(), pos.lng());
					 readTextFile('weather/temp.09.25.2013.txt');
				 }
			});  
		});     
	}
	
	
	function loadForecast(lat, longitude)
	{
		conditions = forecast.getCurrentConditions(lat, longitude);
		var temp = conditions.getTemperature();
		var humidity = (Math.round(conditions.getHumidity()*100));
		var wind_speed = conditions.getWindSpeed();
		var wind_bearing = conditions.getWindBearing();
		
			
		$("#temperature #value").text(temp);
		$("#humidity #value").text(humidity);
		$("#wind-speed #value").text(wind_speed);
		$("#wind-bearing").css("transition","all 1s ease-in-out");
		$("#wind-bearing").css("transform", "rotate("+wind_bearing+"deg)");
		$("#wind-bearing-value #value").text(wind_bearing);

	}
		
	function getGPS(address, output)
	{
	    geocoder.geocode( { 'address': address}, function(results, status) 
	        {
	          if (status == google.maps.GeocoderStatus.OK) 
	          {
	          	console.log(results);
	          	output(results[0].geometry.location);
	          }
	          else 
	          {
	              console.log(status);
	          }
	        }
	    );
	}
		
	function getAddress(location, output)
	{
		console.log(location);
		//glat = location.lat();
		//glng = location.lng();
	    geocoder.geocode( { 'latLng': location }, function(results, status)
	        {
	        	//console.log(status);
	          if (status == google.maps.GeocoderStatus.OK)
	          {
		          	output(results[0].formatted_address);
	          }
	          else
	          {
	          		//console.log(status);
	          }
	        }
	    );
	}
		
	function getCurrentLocation(callback)
	{
		navigator.geolocation.getCurrentPosition(function(position){
			var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
			glat = position.coords.latitude;
			glng = position.coords.longitude;
			slideMapDown(pos);    
			callback(pos);
			console.log(pos);
		}, displayError);
	}
		
	function displayError(error) 
	{
	  var errors = { 
		1: 'Permission denied',
		2: 'Position unavailable',
		3: 'Request timeout'
	  };
	  alert("Error: " + errors[error.code]);
	} 		      
		  
	function setDrawing(icon, title, name, size) 
	{
		var relativePixelSize = pixelSizeAtZoom0*Math.pow(2,gmap.getZoom());
		
		var markerImage = new google.maps.MarkerImage(
		    icon,
		    new google.maps.Size(size*relativePixelSize,size*relativePixelSize), //size
		    null, //origin
		    null, //anchor
		    new google.maps.Size(size*relativePixelSize,size*relativePixelSize) //scale
		);
	
	
		drawingManager.setOptions({
		   drawingMode: google.maps.drawing.OverlayType.MARKER,
		   drawingControl: true,
		   drawingControlOptions: {
			 position: google.maps.ControlPosition.TOP_CENTER,
			 drawingModes: [
			   google.maps.drawing.OverlayType.MARKER,
			   google.maps.drawing.OverlayType.POLYGON,
			 ]
		   },
		   markerOptions: {
			 icon: markerImage,
			 draggable: true,
			 title: title,
			 raiseOnDrag: false
		   }
	 	});
   	}
		   
   	function removePolygonDrawing()
   	{
	   drawingManager.setOptions({
		 drawingMode: google.maps.drawing.OverlayType.MARKER,
		 drawingControl: true,
		 drawingControlOptions: {
		   position: google.maps.ControlPosition.TOP_CENTER,
		   drawingModes: [google.maps.drawing.OverlayType.MARKER]
		 },
		 markerOptions: {
		 	icon: 'img/null.png'
		 }
	   });
   	}
   
   	function addPolygonDrawing()
   	{
	   drawingManager.setOptions({
		 drawingMode: google.maps.drawing.OverlayType.POLYGON,
		 drawingControl: true,
		 drawingControlOptions: {
		   position: google.maps.ControlPosition.TOP_CENTER,
		   drawingModes: [google.maps.drawing.OverlayType.POLYGON]
		 }
	   });
   	}
   	
   	// Removes the overlays from the map, but keeps them in the array
   	function addMarker(marker, width, height, name) {
   	  markersArray.push({'marker': marker, 'width': width, 'height':height, 'name':name});
   	  updateProgressBars();
   	}
						  
	// Removes the overlays from the map, but keeps them in the array
	function clearOverlays() {
	  if (markersArray) {
		for (i in markersArray) {
		  markersArray[i].setMap(null);
		}
	  }
	}
			
	// Shows any overlays currently in the array
	function showOverlays() {
	  if (markersArray) {
		for (i in markersArray) {
		  markersArray[i].setMap(gmap);
		}
	  }
	}
			
	// Deletes all markers in the array by removing references to them
	function deleteOverlays() {
	  if (markersArray) {
		for (i in markersArray) {
		  markersArray[i].setMap(null);
		}
		markersArray.length = 0;
	  }
	}
	
	
	function scroll(id)
	{
		$("html, body").animate({ scrollTop: $(id).offset().top - 75}, 1000);
	}
		
	function refreshSpy()
	{
		$('[data-spy="scroll"]').each(function () {
		  $(this).scrollspy('refresh');
		});
	
	}
 	
 	function updateProgressBars()
 	{
 		var newArray = _.pluck(markersArray, 'marker');
 		key_size = _.size(_.where(newArray, {title: "key"}));
 		n_size = _.size(_.where(newArray, {title: "nitrogen"}));
 		p_size = _.size(_.where(newArray, {title: "pests"}));
 		both_size = _.size(_.where(newArray, {title: "both"}));
 		
 		n_width = ((n_size+both_size)/(key_size*4))*100;
 		p_width = ((p_size+both_size)/(key_size*3))*100;
 		
 		if(n_width > 100)
 			n_width = 100;
 		if(p_width > 100)
 			p_width = 100;
 		$(".nitrogen-bar").css("width", n_width + "%");
 		$(".pests-bar").css("width", p_width + "%");
 		
 		$(".nitrogen-bar-total").css("width", n_width*(4/7) + "%");
 		$(".pests-bar-total").css("width", p_width*(3/7) + "%");
 	
 	}
 	
 	function addGuildList(plant){
 		
 	}
</script>
   
	
	
	
	
	
	
	
	
	
	
	
</body>
</html>
